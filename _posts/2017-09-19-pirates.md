---
layout: post
title: "Talk like a pirate day 2017"
excerpt: ""
categories: articles
tags: [R, ggplot2, pirates, talk-like-a-pirate-day, arrrr!]
published: false
comments: true
author: safferli
share: true
---

# International Talk Like A Pirate Day

![pirates arr, not err!]({{ site.url }}/images/safferli/to-err-to-arr.jpg)
{: .center}

Avast, ye scurvy scum! Today be September 19, the [International Talk Like A Pirate Day](https://en.wikipedia.org/wiki/International_Talk_Like_a_Pirate_Day). While it's a silly "holiday", it's a great chance to switch your Facebook to [Pirate English](http://socmedianews.com/2009/05/facebook-fun-aaargchange-your-language-to-pirate-english/) ("Arr, this be pleasing to me eye!"). Also, it's as good a reason as any to go sailing the Internet Main, scouring for booty (data)! 

Well, any excuse, y'know... 

What is today known (more or less) as "Pirate English" (the bit with all the "arrr!", "ahoy, ye matey!", etc) is in fact the accent employed by Robert Newton, the actor who played Long John Silver in the [first non-silent film ("talkie") Treasure Island](http://www.imdb.com/title/tt0043067/). He speaks with a Bristol accent, which was in fact [the main trading port with the West Indies](https://www.theguardian.com/theguardian/2010/mar/10/pirates-notes-and-queries) (Bristol, not the accent, of course). The accent we today associate with pirates could well have been historical! 

More useless information on pirates (such as that there is no historical evidence of a pirate ever owning a parrot as a pet -- again this stereotype evolved from the Treasure Island movie) is on the wonderful as always treasure trove of superfluous information, the [QI page on pirates](http://qi.com/infocloud/pirates).  


# life expectancy after birth ~50: https://ourworldindata.org/life-expectancy/


# Data

Now, let's get some data on pirates. I thought I had seen data on historical shipping, and also piracy somewhere a while ago, but I cannot find it any more. So, I'll do what any self-respecting student would do and grab data from Wikipedia.  There is a [list of famous pirates](https://en.wikipedia.org/w/index.php?title=List_of_pirates); it's biased, of course. I see relatively few entries on Barbary pirates, for instance. No matter, the list covers most of the Golden Age of Piracy, and I'll use it to generate a dataset on the caribbean pirates. 

We'll grab the wiki page, linking for the static ID of the page for reproducability. 

{% highlight R %}
## retrieve wikipedia list of pirates page
pirates.url <- "https://en.wikipedia.org/w/index.php?title=List_of_pirates&oldid=799791558"

## read the page into R
pirates.wiki <- read_html(pirates.url)
{% endhighlight %}

We then use `purrr::map_dfr` to grab all tables in the HTML, and push them into a single dataframe and do some basic cleaning. Man, I hate Windows; utf-8 and Windows *still in 2017* is a major pain in the stern. 

{% highlight R %}
## grab all tables on the page; tables 3-5 are the ones of main interest
# 3: Rise of the English Sea Dogs and Dutch Corsairs: 1560-1650
# 4: Age of the Buccaneers: 1650-1690
# 5: Golden Age of Piracy: 1690-1730
pirates.raw <- pirates.wiki %>% 
  # grab all data tables; they all have the class "wikitable"
  html_nodes(".wikitable") %>% 
  # extract all tables and put them into one dataframe
  purrr::map_dfr(html_table, fill = TRUE) %>% 
  # clean column names
  setNames(make.names(names(.))) %>% 
  mutate(
    # stupid wiki has capital and non-capital letters in headers...
    Years.active = if_else(is.na(Years.active), Years.Active, Years.active),
    # empty table cells should be NA
    Years.active = parse_character(Years.active),
    Life = parse_character(Life), 
    # god, I hate windows... R on Win will chocke on ‒ and – characters, so replace them with ASCII
    # http://unicode-search.net/unicode-namesearch.pl?term=dash
    # U+2012 to U+2015 are dashes
    Life = stringr::str_replace_all(Life, "(\u2012|\u2013)", "-"),
    Years.active = stringr::str_replace_all(Years.active, "(\u2012|\u2013)", "-")
  ) %>% 
  # keep columns we want and re-order
  select(Name, Life, Country.of.origin, Years.active, Comments)
{% endhighlight %}

With the data now set up, we can set out to graph the pirate activity, and also to build a random pirate generator! 


# Pirates in Action


{% highlight R %}

{% endhighlight %}

Behold, 1200 years of cherry blossom history! 

![sakura plot]({{ site.url }}/images/safferli/sakura.png)
{: .center}


kable(dt) %>%
  kable_styling(bootstrap_options = "striped", full_width = F)



# A Pirate's Life For Me!

With the historical data on pirates and their activity times, we can generate a random pirate story! For this, we will restrict the data to the golden age of piracy (roughly 1500-1700). Since most of the pirates in the dataset are actually from the golden age, drop all pirates with started piracy before 1500, and after 1750. 


## Golden Age Pirate: starting piracy year

From these pirates, let's have a look when they started their pirating activities. 

{% highlight R %}
pirates.fit <- pirates.dta %>% 
  filter(piracing.start > 1500) %>% 
  filter(piracing.start < 1750) %>% 
  mutate(
    arrr = piracing.stop - piracing.start
  )
  
pirates.fit %>% 
  ggplot()+
  geom_density(aes(x=piracing.start))
{% endhighlight %}

![pirates' starting their trade]({{ site.url }}/images/safferli/piracy-goldenage.png)
{: .center}

Unfortunately, it's a heavily left-skewed distribution, and after some hours of looking into distributions, I couldn't find a good fit, and we'll have to resort to pulling from the empirical distribution (ie, the data itself) for generating a random start year for a pirate: 

{% highlight R %}
f.gen.pirating.startyear <- function() {
  # generate a startyear by pulling from the empirical distribution (pirates.fit$piracing.start)
  base::sample(pirates.fit$piracing.start, 1)
}
{% endhighlight %}


## Golden Age Pirate: piracing tenure

We have better luck with the tenure of a pirate: the distribution is clearly exponential. 

{% highlight R %}
pirates.fit %>% 
  ggplot()+
  geom_density(aes(x=piracing.start))
{% endhighlight %}

![pirates' tenure]({{ site.url }}/images/safferli/piracy-goldenage-tenure.png)
{: .center}

As it's discrete data, we'll use the negative binomial distribution to estimate the theoretical distribution of a pirate's tenure using `library(fitdistrplus)`.

{% highlight R %}
#library(fitdistrplus)
# check which distribution would be a good fit: 
#fitdistrplus::descdist(pirates.fit$arrr, boot = 1000)

# negative binomial
f1 <- fitdistrplus::fitdist(pirates.fit$arrr, "nbinom")
fitdistrplus::plotdist(pirates.fit$arr, "nbinom", para = list(size=f1$estimate[1], mu=f1$estimate[2]))
{% endhighlight %}

The results are excellent: we can clearly see the oversampling of "round" years (10, in particular), which comes from the fact that with uncertain dates, Wikipedia noted a pirate's activity in decades, rather than actual years. But still, our distribution of `rnbinom(x, size = 0.3876683, mu = 6.395578)` works nicely. 

![pirates' tenure estimation]({{ site.url }}/images/safferli/pirate-tenure-negbin.png)
{: .center}

We can thus draw a random tenure for a pirate by this function: 

{% highlight R %}
f.gen.pirating.tenure <- function() {
  # generate a tenure time from the estimated theoretical neg binomial distribution (pirates.fit$arrr)
  rnbinom(1, size=f1$estimate[1], mu=f1$estimate[2])
}
{% endhighlight %}

## Golden Age Pirate: silly name generator

All that is missing now is a random pirate name generator. [Fantasy name generator](http://www.fantasynamegenerators.com/pirate-names.php) have a nice collection of name generators, and a pirate one is included! They allow the use of the names "to name anything in any of your own works", so let's use them here! 

We source the names into R and create a simple function pulling a random name, allowing you to specify male or female. 

{% highlight R %}
source("pirate-names.R")

f.gen.pirate.name <- function(female = FALSE) {
  # generate a pirate name from a list of 
  # - first names (male/female)
  # - nick names (male/female)
  # - last names
  if(female) {
    paste(
      base::sample(names.female, 1), 
      base::sample(names.nickf, 1), 
      base::sample(names.last, 1)
    )
  } else {
    paste(
      base::sample(names.male, 1), 
      base::sample(names.nickm, 1), 
      base::sample(names.last, 1)
    )
  }
}
{% endhighlight %}


## Golden Age Pirate: a pirate's story! 

With all the pieces set up, we can now generate a random pirate! 

{% highlight R %}
f.pirate.story <- function(female = FALSE) {
  # build the pirate story by joining name, startyear, and tenure time
  yy <- f.gen.pirating.startyear()
  rr <- paste0(
    "Your name is ", 
    f.gen.pirate.name(female), 
    " and you roamed the Caribbean from ", 
    yy, " to ", yy+f.gen.pirating.tenure(),
    ". Arrr! \u2620"
  )
  return(rr)
}
{% endhighlight %}

`\u2620` is the utf-8 code for the [skull-and-crossbones emoji](https://emojipedia.org/emoji/%E2%98%A0/). Calling the function several times then results in: 


| female | story                                                                                            |
|--------|--------------------------------------------------------------------------------------------------|
| FALSE  | Your name is Gerard 'The Fierce' Eastoft and you roamed the Caribbean from 1603 to 1605. Arrr! ☠ |
| FALSE  | Your name is Orton 'Grommet' Drachen and you roamed the Caribbean from 1657 to 1657. Arrr! ☠     |
| FALSE  | Your name is Ascot 'Shadow' Artemis and you roamed the Caribbean from 1650 to 1652. Arrr! ☠"     |
| TRUE   | Your name is Ethyl 'Temptress' Mitchell and you roamed the Caribbean from 1610 to 1625. Arrr! ☠  |
| TRUE   | Your name is Christine 'Daffy' Ward and you roamed the Caribbean from 1657 to 1657. Arrr! ☠      |
| TRUE   | Your name is Huldah 'Twitching' Vome and you roamed the Caribbean from 1718 to 1718. Arrr! ☠     |


# Concluding remarks

The code is available on [github](https://github.com/safferli/pirates), as always. 






